build: off

init:
  - git config --global core.autocrlf input

environment:
  CYG_MIRROR: http://cygwin.mirror.constant.com
  CYG_PACKAGES: bash,xxd,cmake,make,gcc-core,gcc-g++,zlib-devel,libbz2-devel,busybox-standalone,git,binutils
  CYG_ROOT: C:\cygwin64
  CYG_CACHE: C:\cygwin64\var\cache\setup
  CYG_SETUP: C:\cygwin64\setup-x86_64.exe
  BASH: C:\cygwin64\bin\bash
  PKEY:
    secure: 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

cache:
  - C:\cygwin64\var\cache\setup

install:
  - if defined CYG_ROOT (%CYG_SETUP% --quiet-mode --no-shortcuts --only-site --root "%CYG_ROOT%" --site "%CYG_MIRROR%" --local-package-dir "%CYG_CACHE%" --packages "%CYG_PACKAGES%" --upgrade-also)

build_script:
  - if defined BASH (%BASH% -lc "${APPVEYOR_BUILD_FOLDER}/util/build_windows.sh $(cygpath ${APPVEYOR_BUILD_FOLDER}) $(cygpath ${APPVEYOR_BUILD_FOLDER})/build")
  - cd %APPVEYOR_BUILD_FOLDER%\build && 7z a %APPVEYOR_BUILD_FOLDER%\mmseqs-win64.zip mmseqs

on_success:
  - ps: >-
      if (Test-Path "C:\Users\appveyor\.ssh\id_rs") {
          Remove-Item "C:\Users\appveyor\.ssh\id_rsa"
      }
      if(($env:appveyor_repo_branch -eq 'master') -and (-not (Test-Path env:APPVEYOR_PULL_REQUEST_NUMBER))) {
          $fileContent = "-----BEGIN RSA PRIVATE KEY-----`n"
          $fileContent += $env:PKEY.Replace(' ', "`n")
          $fileContent += "`n-----END RSA PRIVATE KEY-----`n"
          Set-Content "C:\Users\appveyor\.ssh\id_rsa" $fileContent
      }
  - if exist C:\Users\appveyor\.ssh\id_rsa ( ssh -o StrictHostKeyChecking=no codeship@uniclust.mmseqs.com "mkdir -p /home/mirdita/repositories/mmseqs-webserver/archive/%APPVEYOR_REPO_COMMIT%" )
  - if exist C:\Users\appveyor\.ssh\id_rsa ( cd %APPVEYOR_BUILD_FOLDER% && scp -o StrictHostKeyChecking=no mmseqs-win64.zip codeship@uniclust.mmseqs.com:/home/mirdita/repositories/mmseqs-webserver/archive/%APPVEYOR_REPO_COMMIT% )
